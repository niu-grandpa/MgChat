# 问题收集

## 前端

### 难点

0.如何知道是未读的新消息？怎么实现点开聊天窗口后不统计实时新消息？

1.如何实现窗口复用？

2.如何跨窗口获取数据？

3.当前路由页面下的子路由渲染新窗口，会导致父子路由一并渲染到新窗口？

- 窗口是通过调用 window.loadURL 加载对应的页面，而不是调用路由库的方法进行路由跳转，毕竟是要通过主进程的方法创建新窗口，那么使用嵌套的父子路由就会造成，既加载了父路由的 url 地址又拼接上了子路由路径。

4.如何实现消息缓存？

5.如何实现消息收发？怎么知道是发给我的？

6.快速登录注册怎么实现的？自动登录怎么实现的？怎么解决重复登陆？

7.用户等级升级怎么实现的？

8.收发验证码和有效期怎么实现的？

9.可取消的执行函数

10.第一次执行自动登录后，我再退出登陆，又会进行自动登录。

- 将自动登录的次数记录在全局状态管理器中，首次自动登录是 0 执行完自动登录后次数加+1，下次再回到登录界面时，判断次数是否大于 0，如果是就不执行自动登录。

11.聊天窗口没有随着消息自动滚动到最新位置

12.如何在渲染进程控制窗口显示/隐藏/关闭

- 首先在创建新窗口时调用的主线程自定义事件open-win方法，会传入参数pathname路由路径，它会将其作为缓存表中的key值映射窗口实例，所以其他操作窗口的方法也需要传入相同对应的pathname参数，用于到缓存中查找实例。顺带提一句，在渲染进程中，如果需要传递参数必须使用路径拼接参数的方式，而不是通过路由方法传参，并且路由表需提前配置好path的传参方式，"path/:data"，否则会造成缓存无法查找到对应实例。

13.如何解决未在线的情况下会错过实时消息？

### 优化

1.长列表优化

2.消息缓存优化

3.多窗口缓存优化

4.代码优化

5.路由组件懒加载

6.利用事件冒泡机制为列表节点按需绑定事件

### 踩坑

1.useEffect 会默认调用两次

2.在 useEffect 里调用某个函数并把该函数作为依赖，会无限循环调用

3.多个逻辑写在一个 useEffect 里，并且依赖项过多，导致一些与依赖无关的代码也因为该依赖变化而重新执行

4.在钩子函数中无法调用自定义的钩子函数

5.聊天框输入内容发送后，虽然输入框内容清空了，但是鼠标任意点击时，内容又回到输入框里了

6.异步函数无法使用的 bind，call，apply

- 场景：我把中间件函数收集在数组里，之后执行上一个函数后如果它有返回值我想让它能被下一个函数接收到，普通函数没有问题，直接通过 bind 调用加参数，而异步函数的话就报错不存在 bind 方法

- 解决方案： 异步函数的返回值是一个 Promise 对象，而不是一个普通的函数，所以它不能使用 bind 方法来绑定 this 值。

7.无法在 useEffect 里取消定时器，即使取消后仍然执行

8.通过useRef创建的对象，无法动态修改并获取最新属性值

- 原因：使用 useRef 创建的对象是一个持久化的引用，它的属性值的更改不会触发组件的重新渲染。 useRef 主要用于在函数组件中存储可变值，类似于在类组件中使用实例属性。

- 解决方案：使用 useState 来管理状态，并在需要更新属性值时使用 setState 或者直接给属性赋予新的值。这样会触发组件的重新渲染。

- 解决代码

```ts
let tryCount = 0;
useEffect(() => {
  tryCount++;
  if (tryCount !== 2 && auto) handleAutoLogin();
}, [auto]);
```

9.主线程中不能使用有关渲染的代码

## 后端

1.怎么编写通用的处理 crud 逻辑的函数？

2.如何设计每个数据库文档的数据结构？

3.如何连接数据库和搭建服务器？
